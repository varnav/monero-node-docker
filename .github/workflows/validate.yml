name: Validate code

on: [push]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Install hadolint and kubeval
      run: |
        curl -sL -o ${HOME}/hadolint "https://github.com/hadolint/hadolint/releases/download/v1.17.5/hadolint-$(uname -s)-$(uname -m)"
        chmod 700 ${HOME}/hadolint
        wget https://github.com/instrumenta/kubeval/releases/latest/download/kubeval-linux-amd64.tar.gz
        tar xf kubeval-linux-amd64.tar.gz
        sudo cp kubeval /usr/local/bin
    - name: Run hadolint
      run: ${HOME}/hadolint --ignore DL3015 --ignore DL3003 --ignore DL3008 --ignore DL3018 Dockerfile
    - name: Run kubeval
      run: sudo kubeval kubernetes-deployment.yml
